name: Notify Changelog

on:
  push:
    branches:
      - master   # hoáº·c branch báº¡n muá»‘n theo dÃµi


jobs:
  changelog:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract last changelog section
        id: changelog
        run: |
          # Äáº£o ngÆ°á»£c file vÃ  láº¥y block cuá»‘i cÃ¹ng báº¯t Ä‘áº§u báº±ng "## "
          CONTENT=$(tac CHANGELOG.md | awk '/^## /{if (p) exit; p=1} p' | tac)

          # Escape kÃ½ tá»± Ä‘áº·c biá»‡t Ä‘á»ƒ nhÃ©t vÃ o JSON
          CONTENT=$(echo "$CONTENT" | sed 's/"/\\"/g')

          echo "CONTENT=$CONTENT" >> $GITHUB_ENV

      - name: Send to Discord
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"ðŸ“¢ **New push to main!**\n\`\`\`\n$CONTENT\n\`\`\`\"}" \
               ${{ secrets.DISCORD_WEBHOOK }}
