name: Notify Changelog

on:
  push:
    branches:
      - master   # theo d√µi master

jobs:
  changelog:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract last changelog section
        id: changelog
        run: |
          # ƒê·∫£o ng∆∞·ª£c file v√† l·∫•y block cu·ªëi c√πng b·∫Øt ƒë·∫ßu b·∫±ng "## "
          CONTENT=$(tac CHANGELOG.md | awk '/^## /{if (p) exit; p=1} p' | tac)

          # Ghi multiline v√†o bi·∫øn m√¥i tr∆∞·ªùng
          {
            echo 'CONTENT<<EOF'
            echo "$CONTENT"
            echo 'EOF'
          } >> $GITHUB_ENV

      - name: Send to Discord
        run: |
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"üì¢ **New push to master!**\n\`\`\`\n$CONTENT\n\`\`\`\"}" \
               ${{ secrets.DISCORD_WEBHOOK }}
